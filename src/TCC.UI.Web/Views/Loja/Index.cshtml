@using Microsoft.AspNetCore.Identity;
@using TCC.Domain.Models;
@model IEnumerable<TCC.Application.ViewModels.ItemLojaViewModel>

@inject UserManager<Usuario> UserManager

@{
	ViewData["Title"] = "LogPlay - Loja";
}

<div class="loja-main-container">
    <header>
        <h1>Loja de Itens</h1>
        <div class="moedas">
            Suas Moedas:
            <span id="moedas-usuario">@UserManager.GetUserAsync(User).Result.QtdMoedas</span>
        </div>
    </header>

    <div class="cards-container">
        @for (var i = 0; i < Model.Chunk(3).Count(); i++)
        {
            @foreach (var item in Model.Skip(i * 3).Take(3))
            {
                <div class="card">
                    <img src="~/assets/img/Loja/@item.ImagemUrl" alt="Item 1">
                    <h2>@item.Nome</h2>
                    <p>@item.Descricao</p>
                    <p>@item.Preco</p>
                    <button class="btnComprar" onclick="Comprar('@item.Id.ToString()')">Comprar</button>
                </div>
            }
        }
    </div>
</div>

@section Scripts{

    <script>
        function Comprar(id) {
            Swal.fire({
                title: 'Deseja confirmar a compra?',
                showCancelButton: true,
                cancelButtonText: 'Cancelar',
                confirmButtonText: 'Comprar',
                confirmButtonColor: '#201b2c',
                showLoaderOnConfirm: true,
                preConfirm: () => {
                    //const baseURL = "https://localhost:7072"
                    const baseURL = "https://logplay.net"
                    console.log(this);
                    $.get(`${baseURL}/Loja/Comprar/${id}`)
                        .then(function (response) {
                            if (!response.ok) {
                                Swal.fire({
                                    icon: 'error',
                                    title: 'Não foi possível efetuar a compra.',
                                    text: `${response.errorMessage}`
                                })
                            }
                            else {
                                Swal.fire({
                                    position: 'center',
                                    icon: 'success',
                                    title: 'Compra efetuada!',
                                    showConfirmButton: false,
                                    timer: 1500
                                })
                            }
                            return response
                        })
                    return promise;
                },
                allowOutsideClick: false
            })
        }
    </script>

    }


@section Styles{
    <link rel="stylesheet" href="~/css/Loja/loja.css">
}